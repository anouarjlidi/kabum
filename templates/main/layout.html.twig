{#
Copyright 2019 Douglas Silva (0x9fd287d56ec107ac)

This file is part of KaBuM!.

KaBuM! is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with KaBuM!.  If not, see <https://www.gnu.org/licenses/>.
#}

{% extends 'base.html.twig' %}

{% block stylesheets %}
  {{ parent() }}
  {{ encore_entry_link_tags('main') }}
{% endblock %}

{% block body %}
  <div class="d-flex flex-column flex-md-row">
    <header class="sticky-sidebar">
      <div class="d-flex justify-content-md-center justify-content-between p-2">
        <a href="{{ path('main_page') }}" aria-label="{{ 'go_home_page'|trans }}">
          <img src="{{ asset('images/kabum.png') }}" class="header-logotype" alt="{{ 'logotype'|trans }}">
        </a>
        <button class="kabum-collapse-button d-md-none" type="button" data-toggle="collapse"
          data-target="#ss-collapsible" aria-expanded="false" aria-controls="ss-collapsible"
          aria-label="{{ 'toggle_main_menu'|trans }}">
          <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
      </div>
      <div id="ss-collapsible" class="sticky-sidebar-collapsible collapse">
        <div class="p-2 mb-2">
          <div class="d-flex justify-content-center">
            <a class="kabum-action-button flex-fill" role="button"
              href="#" aria-label="{{ 'shopping_cart'|trans }}">
              <i class="fas fa-shopping-cart kabum-action-icon" aria-hidden="true"></i>
            </a>
            {% if app.user %}
              <a class="kabum-action-button flex-fill" role="button"
                href="#" aria-label="{{ 'wishlist'|trans }}">
                <i class="fas fa-bookmark kabum-action-icon" aria-hidden="true"></i>
              </a>
            {% endif %}
            {% if app.user %}
              <div class="dropdown flex-fill">
                <a class="kabum-action-button dropdown-toggle"
                  href="#" role="button" id="user-menu" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false" aria-label="{{ 'user_menu'|trans }}">
                  <i class="fas fa-user kabum-action-icon" aria-hidden="true"></i>
                </a>

                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="user-menu">
                  {% if is_granted('ROLE_ADMIN') %}
                    <a class="dropdown-item" href="{{ path('admin_new_product') }}">{{ 'control_panel'|trans }}</a>
                  {% endif %}
                  <a class="dropdown-item" href="{{ path('user_account') }}">{{ 'your_account'|trans }}</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="{{ path('app_logout') }}">{{ 'sign_out'|trans }}</a>
                </div>
              </div>
            {% else %}
              <a class="kabum-action-button flex-fill"
                href="{{ path('app_login') }}" aria-label="{{ 'sign_in_kabum_account'|trans }}">
                <i class="fas fa-sign-in-alt kabum-action-icon" aria-hidden="true"></i>
              </a>
            {% endif %}
          </div>
        </div>
        <div class="instant-search mx-3 mb-3">
          <form action="{{ path('search') }}" role="search">
            <div class="d-flex justify-content-between align-items-center search-input-wrapper">
              <label for="is-input" class="mr-2 mb-0">
                <span class="sr-only">{{ 'search'|trans }}</span>
                <i class="fas fa-search text-secondary" aria-hidden="true"></i>
              </label>
              <input id="is-input" type="search" name="query" data-target="{{ path('instant_search') }}"
                class="instant-search-input search-input" placeholder="{{ 'search'|trans }}"
                autocomplete="off" role="combobox" aria-autocomplete="list"
                aria-describedby="is-help" aria-expanded="false"
                aria-controls="is-box is-status"/>
              <span id="is-help" class="sr-only">
                {{ 'results_appear_as_you_type'|trans }}
              </span>
              <span id="is-status" class="instant-search-status sr-only" role="status"></span>
              <div id="is-box" class="instant-search-box" role="listbox">
                <div class="instant-search-result list-group"></div>
              </div>
            </div>
          </form>
        </div>
        <div class="p-2">
          <div class="bg-light rounded p-2">
            <p class="lead text-kabum-orange mb-2">{{ 'departments'|trans }}</p>
            <nav class="sticky-sidebar-scrollable nav flex-column flex-nowrap">
              {# This is used to set the current page indicator on items of the
              departments list. If defined, it will retrieve the category slug
              from the current request. If it's not, an empty string is passed
              to the controller instead, which effectively prevents the indicator
              from being set. #}
              {% if app.request.attributes.get('_route_params').category_slug is defined %}
                {% set slug = app.request.attributes.get('_route_params').category_slug %}
              {% else %}
                {% set slug = '' %}
              {% endif %}

              {{ render(controller('App\\Controller\\MainController::categoryList', {currentPageSlug: slug})) }}
            </nav>
          </div>
        </div>
      </div>
    </header>
    <main id="main-content" class="d-flex flex-column w-100">
      {% block main %}{% endblock %}
    </main>
  </div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  {{ encore_entry_script_tags('main') }}
{% endblock %}
